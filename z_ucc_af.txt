z_ucc_af1:--z_ucc_af1
declare @t_bdate nvarchar(20)
declare @t_edate nvarchar(20)
set @t_bdate = case when '#non' = [2] then '' else [2] end
set @t_edate = case when '#non' = [3] then CHAR(255) else [3] end
declare @tmp table(
	gno nvarchar(10),
	custno nvarchar(35),
	custs nvarchar(90),
	mainsno nvarchar(35),
	storeno nvarchar(35),
	stores nvarchar(90),
	productno nvarchar(50),
	products nvarchar(90),
	unit nvarchar(12),
	mount float
)
insert into @tmp
	select
		a.gno,a.custno,c.nick,isnull(b.noa,''),a.storeno,isnull(b.store,''),a.productno,a.product,a.unit,sum(a.mount)
	from (
		select
			'0' gno,b.custno,a.storeno,a.productno,a.product,a.unit,sum(a.mount)*(-1) mount
		from view_vccs a
		left join view_vcc b on a.noa= b.noa
		where (b.datea between @t_bdate and @t_edate)
		group by b.custno,a.storeno,a.productno,a.product,a.unit
		union
		select
			'0' gno,a.custno,b.storeno,b.productno,b.product,b.unit,sum(b.mount) mount
		from view_ina a 
		left join view_inas b on a.noa = b.noa
		where (a.datea between @t_bdate and @t_edate)
		group by a.custno,b.storeno,b.productno,b.product,b.unit
		union
		select
			'0' gno,a.custno,a.storeno,b.productno,b.product,b.unit,sum(b.mount)*(-1) mount ------調出倉庫
		from view_cng a 
		left join view_cngs b on a.noa = b.noa
		where (a.datea between @t_bdate and @t_edate)
		group by a.custno,a.storeno,b.productno,b.product,b.unit
		union
		select
			'0' gno,a.custno,a.storinno,b.productno,b.product,b.unit,sum(b.mount) mount ------調入倉庫
		from view_cng a 
		left join view_cngs b on a.noa = b.noa
		where (a.datea between @t_bdate and @t_edate)
		group by a.custno,a.storinno,b.productno,b.product,b.unit
	) a 
	left join store b on left(a.storeno,len(b.noa))=b.noa
	left join cust c on a.custno = c.noa
	group by a.gno,a.custno,c.nick,isnull(b.noa,''),a.storeno,isnull(b.store,''),a.productno,a.product,a.unit
select * from @tmp order by mainsno,gno,storeno;